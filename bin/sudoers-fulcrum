#!/bin/bash

# NOTE: THIS SHOULD NOT BE RUN DIRECTLY, instead to be used like:
# bash /usr/local/fulcrum/bin/sudoers-fulcrum > /tmp/sudoers-fulcrum && visudo -c -f /tmp/sudoers-fulcrum && cat /tmp/sudoers-fulcrum | sudo tee /etc/sudoers.d/sudoers-fulcrum

echo "fulcrum	ALL=(ALL)	NOPASSWD:	/usr/local/fulcrum/bin/dps \"\""
echo ""
echo "# fulcrum drush commands"

cd /usr/local/fulcrum/conf && ls *.json | grep -v \* | sed 's/\.json$//' |
while IFS= read -r site; do
  echo "fulcrum	ALL=(ALL)	NOPASSWD:	/usr/local/fulcrum/bin/drush $site cc all"
  echo "fulcrum	ALL=(ALL)	NOPASSWD:	/usr/local/fulcrum/bin/drush $site rr"
  echo "fulcrum	ALL=(ALL)	NOPASSWD:	/usr/local/fulcrum/bin/drush $site updb"
done